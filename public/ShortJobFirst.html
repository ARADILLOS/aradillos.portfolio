<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SJF Non-Preemptive Calculator</title>
<style>
    body { font-family: Arial, sans-serif; background: #f0f4f8; padding: 20px; }
    h2 { text-align: center; }
    input { padding: 5px; margin: 5px; width: 80px; }
    button { padding: 5px 10px; margin: 5px; cursor: pointer; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; background: #fff; }
    th, td { border: 1px solid #000; padding: 8px; text-align: center; }
    th { background: #4f46e5; color: white; }
    .gantt { display: flex; margin-top: 20px; }
    .gantt div { margin-right: 2px; padding: 10px; background: #4f46e5; color: white; font-weight: bold; }
    .process-inputs { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
    .process-input { display: flex; flex-direction: column; border: 1px solid #ccc; padding: 10px; border-radius: 5px; background: #fff; }
    .process-input button { width: fit-content; margin-top: 5px; background:red;color:white;border:none;padding:2px 6px;cursor:pointer; }
</style>
</head>
<body>
<h3>Processes</h3>
<div id="processContainer" class="process-inputs"></div>
<button onclick="addProcess()">Add Process</button>
<button onclick="resetAll()">Reset All</button>
<button onclick="calculateSJF()">Calculate</button>

<h3>Result Table</h3>
<table id="resultTable">
    <thead>
        <tr>
            <th>Process</th>
            <th>Arrival Time</th>
            <th>Burst Time</th>
            <th>Completion Time</th>
            <th>Turnaround Time</th>
            <th>Waiting Time</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<h3>Gantt Chart</h3>
<div id="ganttChart" class="gantt"></div>

<script>
let processCount = 0;
let processes = [];

function addProcess() {
    processCount++;
    const container = document.getElementById("processContainer");

    const div = document.createElement("div");
    div.className = "process-input";
    div.id = `process-${processCount}`;

    div.innerHTML = `
        <strong>P${processCount}</strong>
        <label>Arrival Time: <input type="number" min="0" value="0" class="arrival"></label>
        <label>Burst Time: <input type="number" min="1" value="1" class="burst"></label>
        <button onclick="removeProcess(${processCount})">Remove</button>
    `;

    container.appendChild(div);
}

function removeProcess(id) {
    const div = document.getElementById(`process-${id}`);
    if(div) div.remove();
}

function resetAll() {
    document.getElementById("processContainer").innerHTML = "";
    document.querySelector("#resultTable tbody").innerHTML = "";
    document.getElementById("ganttChart").innerHTML = "";
    processCount = 0;
}

function calculateSJF() {
    const divs = document.getElementById("processContainer").children;
    if(divs.length === 0) return alert("Add at least one process");

    processes = [];
    for(let i = 0; i < divs.length; i++){
        const pid = i+1;
        const arrival = parseInt(divs[i].querySelector(".arrival").value);
        const burst = parseInt(divs[i].querySelector(".burst").value);
        processes.push({pid, arrival, burst, remaining: burst});
    }

    // Sort by arrival time
    processes.sort((a,b) => a.arrival - b.arrival);

    let currentTime = 0;
    const result = [];
    const ganttOrder = [];

    while(processes.some(p => p.remaining > 0)){
        // Filter arrived processes that are not done
        const available = processes.filter(p => p.arrival <= currentTime && p.remaining > 0);
        let nextProcess;
        if(available.length > 0){
            // Choose the process with shortest burst time
            available.sort((a,b)=> a.burst - b.burst);
            nextProcess = available[0];
        } else {
            // No process arrived yet, increment time
            currentTime++;
            continue;
        }

        currentTime += nextProcess.burst;
        nextProcess.remaining = 0;
        nextProcess.completion = currentTime;
        nextProcess.turnaround = nextProcess.completion - nextProcess.arrival;
        nextProcess.waiting = nextProcess.turnaround - nextProcess.burst;

        result.push(nextProcess);
        ganttOrder.push(nextProcess);
    }

    // Render table
    const tbody = document.querySelector("#resultTable tbody");
    tbody.innerHTML = "";
    result.forEach(p => {
        tbody.innerHTML += `<tr>
            <td>P${p.pid}</td>
            <td>${p.arrival}</td>
            <td>${p.burst}</td>
            <td>${p.completion}</td>
            <td>${p.turnaround}</td>
            <td>${p.waiting}</td>
        </tr>`;
    });

    // Render Gantt chart
    const gantt = document.getElementById("ganttChart");
    gantt.innerHTML = "";
    ganttOrder.forEach(p => {
        const div = document.createElement("div");
        div.textContent = `P${p.pid}`;
        div.style.flex = p.burst;
        gantt.appendChild(div);
    });
}
</script>

</body>
</html>
